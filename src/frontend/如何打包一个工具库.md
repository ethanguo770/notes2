---
title: å¼€å‘ä¸€ä¸ªå·¥å…·åº“
icon: npm
order: 1
author: Amos
date: 2022-07-10
category:
  - utils
  - npm
tag:
  - npm
  - rollup
  - webpack
  - jest
  - eslint
  - commitizen
---

## ä¸€ã€ç›®çš„

å‡å°‘é‡å¤ï¼Œå¿«é€Ÿå®ç°ç»„ä»¶å¤ç”¨ï¼Œæ‹’ç»é‡å¤é€ è½®å­

> Don't repeat yourself

## äºŒã€å‡†å¤‡å·¥ä½œ

### 1. æ‰“åŒ…å·¥å…·å¯¹æ¯”

|          | webpack | rollup |
| -------- | ------- | ------ |
| æ‰§è¡Œæ—¶é—´ | 71ms    | 17ms   |
| æ–‡ä»¶å¤§å° | 389KB   | 262KB  |

::: echarts å¯¹æ¯”å›¾

```json
{
  "colors": ["#5470C6", "#91CC75", "#EE6666"],
  "xAxis": [
    {
      "type": "category",
      "data": ["webpack", "rollup"]
    }
  ],
  "yAxis": [
    {
      "type": "value",
      "name": "æ‰§è¡Œæ—¶é—´",
      "position": "right",
      "axisLabel": {
        "formatter": "{value} ms"
      }
    },
    {
      "type": "value",
      "name": "æ–‡ä»¶å¤§å°",
      "position": "left",
      "axisLabel": {
        "formatter": "{value} kb"
      }
    }
  ],
  "series": [
    {
      "name": "æ‰§è¡Œæ—¶é—´",
      "type": "bar",
      "data": [71, 17]
    },
    {
      "name": "æ–‡ä»¶å¤§å°",
      "type": "bar",
      "data": [389, 262],
      "yAxisIndex": 1
    }
  ]
}
```

:::

::: info rollup æ˜æ˜¾èƒœå‡º, æœ€ä¸»è¦æ˜¯ rollup æ‰“åŒ…é€Ÿåº¦å¿«å‘€
:::

### 2. è°å†ç”¨?

è™½ç„¶ rollup å‡ºæ¥çš„æ¯”è¾ƒæ™šï¼Œæ€»ä½“ç”Ÿæ€å¯èƒ½ä¸å¦‚ webpackï¼Œä½†ä¹Ÿæœ‰å¾ˆå¤šä¼˜ç§€çš„æ¡†æ¶åœ¨ä½¿ç”¨å®ƒ

- vue
- vite
- pinia
- redux

## ä¸‰ã€ç›´æ¥å¼€å¹²

### 1. å·¥å…·åº“æœ‰å“ªäº›éƒ¨åˆ†ç»„æˆ ï¼Ÿ

```mermaid
flowchart LR

hu(hesai-utils) --æ‰“åŒ… --- rollup
hu -- è¯­æ³• --- typescript
hu -- è§„èŒƒ --- er(eslint & prettier)
hu -- æäº¤ --- hc(husky & commitlint)
hu -- è´¨é‡ --- jest

```

### 2. å·¥å…·åº“åˆå§‹åŒ–

2.1 åˆå§‹åŒ–ä»“åº“ï¼Œå¹¶è°ƒæ•´ `package.json` é…ç½®æ–‡ä»¶

> ä¸‡äº‹å¼€å¤´éš¾

è¿›åº¦ï¼š<progress value="5" max="100"></progress> 5%

```sh
# åˆå§‹åŒ–
npm init
```

```json
{
  "name": "js-utils",
  "version": "1.0.0",
  // å‘å¸ƒåˆ°å…¬æœ‰ä»“åº“åçš„ä¸€ä¸ªè¯´æ˜, æ–¹ä¾¿æ£€ç´¢
  "description": "HESAIå‰ç«¯å·¥å…·åº“",
  // å…¥å£æ–‡ä»¶, å…¶ä»–é¡¹ç›®å¼•å…¥å½“å‰åŒ…æ—¶çš„å…¥å£
  "main": "index.js",
  "scripts": {
    "test": "npm run test"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/ZhixianKwok/js-utils.git"
  },
  // æ–¹ä¾¿åœ¨npmç±»ä¼¼çš„ç½‘ç«™ä¸Šè¿›è¡Œå¿«é€Ÿæ£€ç´¢
  "keywords": ["utils", "å·¥å…·åº“"],
  "author": "guozhixian",
  "license": "ISC"
}
```

è¯¦ç»†ä»£ç 
<StackBlitz id="amos-js-utils" height="50vh" hideExplorer hideNavigation file="package.json" view="editor"/>

### 3. å®‰è£…å·¥å…·åº“

è¿›åº¦ï¼š<progress value="40" max="100"></progress> 40%

3.1 `rollup`å®‰è£…

::: code-tabs#shell

@tab npm

```bash
npm install --save-dev rollup
```

@tab pnpm

```bash
pnpm install --save-dev rollup
```

@tab yarn

```bash
yarn add rollup --dev
```

:::

3.2 `typescript`å®‰è£…

::: tip ä»¥ä¸‹åŒ…çš„å®‰è£…æ–¹å¼ä¸ 3.1 ç±»ä¼¼ï¼Œä¸‹é¢å°†ä»¥ npm ä¸ºå‡†ï¼Œå…¶ä»–å®‰è£…æ–¹å¼å¯ä»¥å‚è€ƒ 3.1, ä¸¾ä¸€åä¸‰ã€‚
:::

- å®‰è£…

```sh
npm install --save-dev typescript
```

- é…ç½® tsconfig.json

```json
{
  "compilerOptions": {
    "target": "es2016",
    "lib": ["esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "noFallthroughCasesInSwitch": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    // ç”¨äºè®¾ç½®åˆ«å
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src/**/*", "*.js"]
}
```

è¯¦ç»†ä»£ç 
<StackBlitz id="amos-js-utils" height="50vh" hideExplorer hideNavigation file="tsconfig.json" view="editor"/>

3.3 `eslint` & `prettier` çš„å®‰è£…

- `eslint` å®‰è£…

> eslint: Find and fix problems in your JavaScript code

```sh
npm install --save-dev eslint
```

::: info
eslint æœ¬èº«å¾ˆåºå¤§ï¼Œç†Ÿæ‚‰æ‰€æœ‰é…ç½®éœ€è¦èŠ±è´¹å¤§é‡çš„æ—¶é—´ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹çš„è§„èŒƒæ¥çº¦æŸæˆ‘ä»¬ï¼Œæ¯”å¦‚ airbnbã€alibaba ç­‰å·²æœ‰çš„å¤§å‚è§„èŒƒï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥ airbnb çš„ä¸ºä¾‹
:::

```sh
# å®‰è£…åŸºæœ¬ç‰ˆæœ¬å³å¯ï¼Œè¿™é‡Œä¸æ¶‰åŠç»„ä»¶
npm install --save-dev eslint-config-airbnb-base
```

airbnb çš„`JavaScript`è§„èŒƒè§ï¼šhttps://github.com/airbnb/javascript

- `eslintrc` é…ç½®ï¼Œ æ–°å¢ `eslintrc.jsæ–‡ä»¶`

```json
{
  "extends": ["airbnb-base", "prettier"],
  "plugins": ["prettier"],
  "rules": {
    "prettier/prettier": "error"
  }
}
```

<StackBlitz id="amos-js-utils" height="50vh" hideExplorer hideNavigation file=".eslintrc.json" view="editor"/>

- `prettier` å®‰è£…

```sh
# eslint-plugin-prettieræ–¹ä¾¿å’Œeslintç»“åˆä½¿ç”¨
npm install --save-dev  prettier eslint-plugin-prettier
```

- `prettier` é…ç½®

```json
{
  "singleQuote": true,
  "trailingComma": "es5",
  "printWidth": 100,
  "proseWrap": "never",
  "endOfLine": "lf",
  "semi": false
}
```

è¯¦ç»†ä»£ç 
<StackBlitz id="amos-js-utils" height="50vh" hideExplorer hideNavigation file=".prettierrc" view="editor"/>

3.4 husky & lint-staged & commitlint & commitizen & commitlint-config-cz

==æäº¤ç›¸å…³çš„å»ºè®®åœ¨æœ¬åœ°å°è¯•ï¼ŒStackBlitz è¿œç¨‹æ‰§è¡Œ husky å‘½ä»¤æ—¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼ï¼ï¼==

::: info ä»¥ä¸‹å†…å®¹å»ºè®®åœ¨æœ¬åœ°å°è¯•

- å®‰è£… husky

> husky æ˜¯ä»€ä¹ˆï¼šModern native Git hooks made easy

```sh
npm install --save-dev husky
```

- é…ç½® package.json

> StackBlitz ä¸æ”¯æŒ npm set-scriptï¼Œå¯ä»¥ç›´æ¥æ·»åŠ åˆ°å°†`"prepare": "husky install"`æ·»åŠ åˆ° package.json ä¸­ï¼Œå¹¶æ‰§è¡Œ npm run prepare

```sh
npm set-script prepare "husky install"
npm run prepare
```

- å®‰è£… lint-staged

> ä»€ä¹ˆæ˜¯ lint-staged: Run linters against staged git files and don't let ğŸ’© slip into your code base!

```sh
npm install --save-dev lint-staged
```

- é…ç½® lint-staged é˜¶æ®µéœ€è¦æ ¡éªŒçš„æ–‡ä»¶ç±»å‹

```json
{
  "name": "js-utils",
  "version": "1.0.0",
  "description": "HESAIå‰ç«¯å·¥å…·åº“",
  "main": "index.js",
  "scripts": {
    "prepare": "husky install",
    "test": "npm run test"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/ZhixianKwok/js-utils.git"
  },
  "keywords": ["utils", "å·¥å…·åº“"],
  "author": "guozhixian",
  "license": "ISC",
  "devDependencies": {
    "eslint": "^8.20.0",
    "eslint-config-airbnb-base": "^15.0.0",
    "eslint-plugin-prettier": "^4.2.1",
    "husky": "^8.0.1",
    "lint-staged": "^13.0.3",
    "rollup": "^2.77.2",
    "typescript": "^4.7.4"
  },
  "lint-staged": {
    "**/*.{js,ts}": ["prettier --write", "eslint"],
    "**/*.{md,json}": ["prettier --write"]
  }
}
```

è¯¦ç»†ä»£ç 
<StackBlitz id="amos-js-utils" height="50vh" hideExplorer hideNavigation file="package.json" view="editor"/>

:::

- 3.n é…ç½® `rollup` æ–‡ä»¶

- æ ¹ç›®å½•æ·»åŠ  `rollup.config.js` æ–‡ä»¶

### n. è¾…åŠ©å·¥å…·å®‰è£…

```

```
